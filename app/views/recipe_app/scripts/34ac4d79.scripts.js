!function(a){function b(a){var b="01",c={};for(var d in a){var e=parseInt(b,2);c[a[d]]={bitMask:e,title:a[d]},b=(e<<1).toString(2)}return c}function c(a,b){var c={};for(var d in a)if("string"==typeof a[d])if("*"==a[d]){var e="";for(var f in b)e+="1";c[d]={bitMask:parseInt(e,2),title:a[d]}}else console.log("Access Control Error: Could not parse '"+a[d]+"' as access definition for level '"+d+"'");else{var e=0;for(var f in a[d])b.hasOwnProperty(a[d][f])?e|=b[a[d][f]].bitMask:console.log("Access Control Error: Could not find role '"+a[d][f]+"' in registered roles while building access for '"+d+"'");c[d]={bitMask:e,title:a[d][f]}}return c}var d={roles:["public","user","admin"],accessLevels:{"public":"*",anon:["public"],user:["user","admin"],admin:["admin"]}};a.userRoles=b(d.roles),a.accessLevels=c(d.accessLevels,a.userRoles)}("undefined"==typeof exports?this.routingConfig={}:exports),angular.module("timelineApp",["ngCookies","ngResource","ngSanitize","ui.router","angucomplete-alt"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){var e=routingConfig.accessLevels;b.otherwise("/"),a.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl",access:e["public"]}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"RegisterCtrl",access:e.anon}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl",access:e.anon}).state("create_recipe",{url:"/recipe/new",templateUrl:"views/recipes/new.html",controller:"RecipeCreateCtrl",access:e.user}).state("edit_recipe",{url:"/recipe/:recipeId/edit",templateUrl:"views/recipes/edit.html",controller:"RecipeEditCtrl",access:e.user}).state("recipes",{url:"/recipes",templateUrl:"views/recipes/index.html",controller:"RecipesCtrl",access:e.user}).state("recipes.show",{url:"/:recipeId",templateUrl:"views/recipes/show.html",controller:"RecipeCtrl",access:e.user});var f=["$location","$q",function(a,b){function c(a){return a}function d(c){return 401===c.status?(a.path("/login"),b.reject(c)):b.reject(c)}return function(a){return a.then(c,d)}}];d.interceptors.push(f),d.defaults.useXDomain=!0,delete d.defaults.headers.common["X-Requested-With"],d.defaults.headers.common.Accept="application/json",d.defaults.headers.common["Content-Type"]="application/json"}]).run(["$rootScope","$location","$cookieStore","$timeout","$http","Auth",function(a,b,c,d,e,f){var g=c.get("user"),h="";g&&(h=g.authentication_token||""),""!=h&&(e.defaults.headers.common.Authorization='Token token="'+h+'", email="'+g.email+'"'),a.$on("$stateChangeStart",function(c,e,g){a.error=null,f.authorize(e.access)||d(f.isLoggedIn()?function(){b.path("/")}:function(){b.path("/login")})})}]),angular.module("timelineApp").controller("MainCtrl",["$scope","Auth",function(a,b){a.user=b.user,a.userRoles=b.userRoles,a.accessLevels=b.accessLevels}]),angular.module("timelineApp").controller("RegisterCtrl",["$scope","$location","Auth",function(a,b,c){a.user={},a.show={},a.user.email="",a.user.password="",a.role=c.userRoles.user,a.userRoles=c.userRoles,a.signup=function(){c.register({user:a.user},function(){b.path("/")},function(a){$rootScope.error=a})}}]),angular.module("timelineApp").controller("LoginCtrl",["$scope","$location","Auth",function(a,b,c){a.user={},a.show={},a.show.form=!1,a.user.email="",a.user.password="",a.login=function(){c.login({user:a.user},function(){b.path("/")},function(b){a.error=b})}}]),angular.module("timelineApp").factory("Auth",["$http","$cookieStore",function(a,b){function c(a){angular.extend(h,a),b.put("user",a)}function d(b,c){a.defaults.headers.common.Authorization='Token token="'+b+'", email="'+c+'"'}function e(){delete a.defaults.headers.common.Authorization}var f=routingConfig.accessLevels,g=routingConfig.userRoles,h=b.get("user")||{email:"",role:g["public"]};return{authorize:function(a,b){return void 0===b&&(b=h.role),a.bitMask&b.bitMask},isLoggedIn:function(a){return void 0===a&&(a=h),a.role.title==g.user.title||a.role.title==g.admin.title},register:function(b,d,e){a.post("/api/v1/users",b).success(function(a){a.user.role=g.user,c(a.user),d()}).error(e)},login:function(b,e,f){a.post("/api/v1/users/sign_in",b).success(function(a){a.user.role=g.user,d(a.user.authentication_token,a.user.email),c(a.user),e()}).error(f)},logout:function(b,d){a["delete"]("/api/v1/users/sign_out",{user:{email:h.email}}).success(function(){c({email:"",role:g["public"]}),e(),b()}).error(function(){c({email:"",role:g["public"]}),e(),console.log("server responded with error"),d()})},accessLevels:f,userRoles:g,user:h}}]),angular.module("timelineApp").factory("Recipe",["$resource",function(a){return a("/api/v1/recipes/:id",{id:"@id"},{get:{method:"GET"},create:{method:"POST"},save:{method:"PATCH"},query:{method:"GET",isArray:!1},"delete":{method:"DELETE"},add_recipe_ingredient:{method:"POST",url:"/api/v1/recipes/:id/add_recipe_ingredient"}})}]),angular.module("timelineApp").directive("accessLevel",["Auth",function(a){return{restrict:"A",link:function(b,c,d){function e(){f&&g&&(a.authorize(g,f)?c.css("display",h):c.css("display","none"))}var f,g,h=c.css("display");b.user=a.user,b.$watch("user",function(a){a.role&&(f=a.role),e()},!0),d.$observe("accessLevel",function(a){a&&(g=b.$eval(a)),e()})}}}]),angular.module("timelineApp").controller("NavCtrl",["$rootScope","$scope","$location","Auth",function(a,b,c,d){b.user=d.user,b.userRoles=d.userRoles,b.accessLevels=d.accessLevels,b.logout=function(){d.logout(function(){},function(a){c.path("/")})}}]),angular.module("timelineApp").controller("RecipesCtrl",["$scope","Recipe",function(a,b){a.load_recipes_and_assign_defaults=function(){a.show={},a.show.browseMode=!0,a.show.recipeMode=!1,a.recipes=b.query(function(b){a.recipes=b.recipes})},a.toggleBrowseAndRecipeMode=function(){a.show.browseMode=!1,a.show.recipeMode=!0}}]),angular.module("timelineApp").controller("RecipeCtrl",["$scope","Recipe","$stateParams",function(a,b,c){b.get({id:c.recipeId},function(b){a.recipe=b.recipe})}]),angular.module("timelineApp").controller("RecipeCreateCtrl",["$scope","Recipe","$stateParams","Auth",function(a,b,c,d){a.load_user_and_assign_id=function(){a.user=d.user,a.recipe={},a.recipe.user_id=a.user.id,a.current_step=1},a.create_recipe_step_one=function(){b.create({recipe:a.recipe},function(b){a.ingredient={},a.recipe=b,a.current_step=2})},a.submit_recipe_ingredient=function(){b.add_recipe_ingredient({recipe_ingredient:a.ingredient},function(){})},a.submit_recipe_step=function(){}}]),angular.module("timelineApp").controller("RecipeEditCtrl",["$scope","Recipe","$stateParams","Auth",function(a,b,c,d){a.load_user_and_recipe=function(){a.user=d.user,b.get({id:c.recipeId},function(b){a.recipe=b.recipe}),a.ingredient={}},a.add_food_element=function(b){void 0!=b?a.ingredient.food_element_id=b.originalObject.id:a.ingredient.food_element_id=""},a.submit_recipe_ingredient=function(){b.add_recipe_ingredient({recipe_ingredient:a.ingredient,id:a.recipe.id},function(){})},a.submit_recipe_step=function(){}}]);