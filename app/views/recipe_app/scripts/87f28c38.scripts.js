!function(a){function b(a){var b="01",c={};for(var d in a){var e=parseInt(b,2);c[a[d]]={bitMask:e,title:a[d]},b=(e<<1).toString(2)}return c}function c(a,b){var c={};for(var d in a)if("string"==typeof a[d])if("*"==a[d]){var e="";for(var f in b)e+="1";c[d]={bitMask:parseInt(e,2),title:a[d]}}else console.log("Access Control Error: Could not parse '"+a[d]+"' as access definition for level '"+d+"'");else{var e=0;for(var f in a[d])b.hasOwnProperty(a[d][f])?e|=b[a[d][f]].bitMask:console.log("Access Control Error: Could not find role '"+a[d][f]+"' in registered roles while building access for '"+d+"'");c[d]={bitMask:e,title:a[d][f]}}return c}var d={roles:["public","user","admin"],accessLevels:{"public":"*",anon:["public"],user:["user","admin"],admin:["admin"]}};a.userRoles=b(d.roles),a.accessLevels=c(d.accessLevels,a.userRoles)}("undefined"==typeof exports?this.routingConfig={}:exports),angular.module("timelineApp",["ngCookies","ngResource","ngSanitize","ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){var e=routingConfig.accessLevels;b.otherwise("/"),a.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl",access:e["public"]}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"RegisterCtrl",access:e.anon}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl",access:e.anon}).state("projects",{url:"/projects",templateUrl:"views/projects/index.html",controller:"ProjectsCtrl",access:e.user});var f=["$location","$q",function(a,b){function c(a){return a}function d(c){return 401===c.status?(a.path("/login"),b.reject(c)):b.reject(c)}return function(a){return a.then(c,d)}}];d.responseInterceptors.push(f)}]).run(["$rootScope","$location","$cookieStore","$timeout","$http","Auth",function(a,b,c,d,e,f){var g=c.get("user"),h="";g&&(h=g.authentication_token||""),""!=h&&(e.defaults.headers.common.Authorization='Token token="'+h+'", email="'+g.email+'"'),a.$on("$stateChangeStart",function(c,e,g){a.error=null,f.authorize(e.access)||d(f.isLoggedIn()?function(){b.path("/")}:function(){b.path("/login")})})}]),angular.module("timelineApp").controller("MainCtrl",["$scope","Auth",function(a,b){a.user=b.user,a.userRoles=b.userRoles,a.accessLevels=b.accessLevels}]),angular.module("timelineApp").controller("RegisterCtrl",["$scope","$location","Auth",function(a,b,c){a.user={},a.show={},a.user.email="",a.user.password="",a.role=c.userRoles.user,a.userRoles=c.userRoles,a.signup=function(){c.register({user:a.user},function(){b.path("/")},function(a){$rootScope.error=a})}}]),angular.module("timelineApp").controller("LoginCtrl",["$scope","$location","Auth",function(a,b,c){a.user={},a.show={},a.show.form=!1,a.user.email="",a.user.password="",a.login=function(){c.login({user:a.user},function(){b.path("/")},function(a){$rootScope.error=a})}}]),angular.module("timelineApp").factory("Auth",["$http","$cookieStore",function(a,b){function c(a){angular.extend(h,a),b.put("user",a)}function d(b,c){a.defaults.headers.common.Authorization='Token token="'+b+'", email="'+c+'"'}function e(){delete a.defaults.headers.common.Authorization}var f=routingConfig.accessLevels,g=routingConfig.userRoles,h=b.get("user")||{email:"",role:g["public"]};return{authorize:function(a,b){return void 0===b&&(b=h.role),a.bitMask&b.bitMask},isLoggedIn:function(a){return void 0===a&&(a=h),a.role.title==g.user.title||a.role.title==g.admin.title},register:function(b,d,e){a.post("/api/v1/users.json",b).success(function(a){a.user.role=g.user,c(a.user),d()}).error(e)},login:function(b,e,f){a.post("/api/v1/users/sign_in.json",b).success(function(a){a.user.role=g.user,d(a.user.authentication_token,a.user.email),c(a.user),e()}).error(f)},logout:function(b,d){a["delete"]("/api/v1/users/sign_out.json",{user:{email:h.email}}).success(function(){c({email:"",role:g["public"]}),e(),b()}).error(d)},accessLevels:f,userRoles:g,user:h}}]),angular.module("timelineApp").directive("accessLevel",["Auth",function(a){return{restrict:"A",link:function(b,c,d){function e(){f&&g&&(a.authorize(g,f)?c.css("display",h):c.css("display","none"))}var f,g,h=c.css("display");b.user=a.user,b.$watch("user",function(a){a.role&&(f=a.role),e()},!0),d.$observe("accessLevel",function(a){a&&(g=b.$eval(a)),e()})}}}]),angular.module("timelineApp").controller("NavCtrl",["$rootScope","$scope","$location","Auth",function(a,b,c,d){b.user=d.user,b.userRoles=d.userRoles,b.accessLevels=d.accessLevels,b.logout=function(){d.logout(function(){},function(b){a.error=b})}}]),angular.module("timelineApp").controller("ProjectsCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);